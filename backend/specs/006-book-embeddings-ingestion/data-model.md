# Data Model: Book Content Embeddings Ingestion

## Entity: Text Chunk
**Description**: Semantic unit of book content with content text, token count, and position in source document

**Fields**:
- `id` (string): Unique identifier for the chunk
- `content` (string): The actual text content of the chunk
- `token_count` (integer): Number of tokens in the chunk
- `position` (integer): Position index in the source document
- `source_url` (string): URL of the original book page
- `section_title` (string): Title of the section containing this chunk

**Validation Rules**:
- Content must not be empty
- Token count must be positive
- Position must be non-negative

## Entity: Embedding Vector
**Description**: Numerical representation of text chunk generated by Cohere embedding model

**Fields**:
- `id` (string): Unique identifier for the embedding
- `vector` (array of floats): The actual embedding vector values
- `chunk_id` (string): Reference to the source text chunk
- `model_version` (string): Version of the embedding model used

**Validation Rules**:
- Vector must have consistent dimensions based on model
- Chunk_id must reference an existing text chunk

## Entity: Qdrant Record
**Description**: Storage unit containing embedding vector, source URL, page title, and chunk metadata

**Fields**:
- `id` (string): Unique identifier for the record in Qdrant
- `vector` (array of floats): The embedding vector
- `payload` (object): Metadata object with:
  - `url` (string): Source URL of the book page
  - `title` (string): Title of the book section/page
  - `content` (string): Text content of the chunk
  - `chunk_index` (integer): Index of the chunk within the document
  - `source_document` (string): Identifier for the source document
  - `created_at` (datetime): Timestamp when record was created

**Validation Rules**:
- Vector dimensions must match collection schema
- Payload must contain all required metadata fields
- ID must be unique within the collection

## Entity: Book URL
**Description**: Public URL of a book page from the deployed Docusaurus site

**Fields**:
- `url` (string): The actual URL string
- `title` (string): Title of the book page
- `last_fetched` (datetime): Timestamp of last fetch attempt
- `status` (string): Status of the URL (e.g., 'pending', 'processed', 'error')
- `etag` (string): ETag for idempotency checks (to prevent duplicates)

**Validation Rules**:
- URL must be a valid HTTP/HTTPS address
- Status must be one of the allowed values

## Relationships

```
Book URL --(1 to many)--> Text Chunk
Text Chunk --(1 to 1)--> Embedding Vector
Embedding Vector --(1 to 1)--> Qdrant Record
```

## State Transitions (for Book URL)

- `pending` → `processing` (when fetch begins)
- `processing` → `processed` (when successfully stored in Qdrant)
- `processing` → `error` (when fetch or processing fails)
- `error` → `pending` (when retry is attempted)